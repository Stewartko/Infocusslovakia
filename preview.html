<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Preview — protected</title>
  <meta name="robots" content="noindex, nofollow" />
  <!-- malá inline favicon, aby nezobrazovalo 404 -->
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Ccircle cx='32' cy='32' r='32' fill='%23121821'/%3E%3Cpath d='M21 24h10l3-4h9v24H21z' fill='%2359c1ff'/%3E%3C/svg%3E">

  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root{ --bg:#0b0f14; --panel:#121821; --text:#eaf0f6; --muted:#9aa8b7; --accent:#59c1ff; --radius:16px; --shadow:0 10px 30px rgba(0,0,0,.35); }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{ margin:0; font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Arial,"Helvetica Neue",sans-serif; color:var(--text); background:#000; }

    .bar{ position:fixed; left:0; right:0; top:0; height:52px; display:flex; align-items:center; justify-content:center; gap:12px; padding:0 14px; z-index:10; background:linear-gradient(180deg, rgba(15,23,34,.85), rgba(15,23,34,.55)); backdrop-filter: blur(8px) saturate(120%); color:var(--text); border-bottom:1px solid rgba(255,255,255,.08); }
    .btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:999px;border:1px solid rgba(255,255,255,.12);background:linear-gradient(180deg,#1a222e,#101722);color:var(--text);text-decoration:none;font-weight:600}

    .stage{position:fixed; inset:0; display:grid; place-items:center; background:#000; overflow:hidden}
    .frame{ position:relative; width:min(92vw, 1200px); aspect-ratio:16/9; background:#000; border:1px solid rgba(255,255,255,.08); border-radius:18px; box-shadow:var(--shadow); overflow:hidden; }
    .frame video{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; filter:saturate(108%) contrast(104%) brightness(1.02); }
    .wm{ position:absolute; right:16px; bottom:14px; width:min(16vw, 150px); opacity:.75; pointer-events:none; filter:drop-shadow(0 1px 2px rgba(0,0,0,.6)); animation: wmPulse 3.2s ease-in-out infinite; }
    @keyframes wmPulse{ 0%,100%{opacity:.38;transform:translateY(0)} 50%{opacity:.82;transform:translateY(-1px)} }

    .wm-tilt{ position:absolute; inset:-20% -10%; z-index:1; pointer-events:none; opacity:.07; display:grid; place-items:center; transform:rotate(-18deg); font-weight:700; font-size: clamp(34px, 8vw, 72px); letter-spacing:.12em; color:#fff; animation: tiltPulse 4.5s ease-in-out infinite; text-align:center; line-height:1.1; }
    @keyframes tiltPulse{ 0%,100%{opacity:.05} 50%{opacity:.10} }

    .denied{ position:fixed; inset:0; display:grid; place-items:center; padding:24px; background:radial-gradient(1200px 800px at 80% -10%, #0f1822 0%, #0b0f14 50%, #0b0f14 100%); text-align:center; }
    .card{ max-width:600px; background:var(--panel); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:20px; box-shadow:var(--shadow) }
    .card h1{margin:0 0 8px; font-size:1.6rem}
    .card p{margin:0 0 12px; color:var(--muted)}

    :where([hidden]){ display:none !important; }
  </style>
</head>
<body>

  <!-- Top info bar -->
  <div class="bar" id="topbar" hidden>
    <small>Preview only — watermark zapnutý</small>
    <a class="btn" href="kontakt.html">Kontakt</a>
  </div>

  <!-- POVOLENÝ OBSAH -->
  <main class="stage" id="stage" hidden>
    <div class="frame">
      <video id="v" autoplay muted loop playsinline preload="metadata" src="assets/teaser.mp4" poster="assets/logo.png"></video>
      <img class="wm" src="assets/logo.png" alt="watermark">
      <div class="wm-tilt">INFOCUSSLOVAKIA • PREVIEW</div>
    </div>
  </main>

  <!-- ZAKÁZANÝ OBSAH -->
  <section class="denied" id="denied">
    <div class="card">
      <h1>Access denied</h1>
      <p>Táto stránka je dostupná len cez špeciálny odkaz.</p>
      <p style="margin:10px 0 14px; color:var(--muted)">Missing or invalid <strong>?k=</strong> token.</p>
      <p><a class="btn" href="index.html">Späť na hlavnú</a></p>
    </div>
  </section>

  <!-- ===== GATE SCRIPT (vložený ÚPLNE NA KONCI) ===== -->
  <script>
(function () {
  const ALLOWED_KEYS = ['infocus-2025-preview'];

  const qs    = new URLSearchParams(location.search);
  const kUrl  = (qs.get('k') || '').trim();
  const kStore= (localStorage.getItem('preview_key') || '').trim();
  const ok    = ALLOWED_KEYS.includes(kUrl) || ALLOWED_KEYS.includes(kStore);

  if (ALLOWED_KEYS.includes(kUrl)) {
    localStorage.setItem('preview_key', kUrl);
  }

  // môžu existovať omylom duplikáty v DOM – spracuj všetky
  const stages  = Array.from(document.querySelectorAll('#stage'));
  const denieds = Array.from(document.querySelectorAll('#denied'));
  const topbar  = document.getElementById('topbar');
  const video   = document.getElementById('v');

  if (ok) {
    stages.forEach(el => { el.hidden = false; el.style.display = 'grid'; });
    denieds.forEach(el => { el.hidden = true;  el.style.display = 'none'; });
    if (topbar) topbar.hidden = false;

    if (video) {
      const io = new IntersectionObserver(es => {
        es.forEach(e => e.isIntersecting ? video.play().catch(()=>{}) : video.pause());
      }, { threshold:.25 });
      io.observe(video);
    }

    window.addEventListener('contextmenu', e => e.preventDefault());
    console.info('[preview] access: OK (source =', ALLOWED_KEYS.includes(kUrl) ? 'url' : 'localStorage', ')',
                 'stages=', stages.length, 'denieds=', denieds.length);

  } else {
    stages.forEach(el => { el.hidden = true;  el.style.display = 'none'; });
    denieds.forEach(el => { el.hidden = false; el.style.display = 'grid'; });
    if (topbar) topbar.hidden = true;
    console.warn('[preview] access denied. url=?k=', kUrl || '(none)', ' stored=', kStore || '(none)');
  }
})();
</script>

</body>
</html>
